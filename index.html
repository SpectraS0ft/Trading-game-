<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crypto Trader Game Simulator with Charts, Actions, Auction & Language</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap"
    rel="stylesheet"
  />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Roboto Mono', monospace;
    }
    /* Scrollbar for portfolio and market tables */
    .scrollbar-thin::-webkit-scrollbar {
      height: 6px;
      width: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background-color: rgba(156, 163, 175, 0.5);
      border-radius: 3px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: transparent;
    }
    /* Fix for Chart.js canvas on mobile */
    #priceChart {
      max-height: 300px;
      width: 100% !important;
      height: 300px !important;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col">
  <header class="bg-gray-800 p-4 shadow-md flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <h1 class="text-3xl font-bold text-center sm:text-left flex-1">Crypto Trader Game Simulator</h1>
    <div class="flex items-center gap-2 text-gray-300 font-mono">
      <label for="language-select" class="select-none">Language:</label>
      <select id="language-select" class="bg-gray-700 text-gray-100 rounded px-3 py-1 font-mono">
        <option value="en" selected>English</option>
        <option value="es">Español</option>
        <option value="fr">Français</option>
        <option value="de">Deutsch</option>
        <option value="zh">中文</option>
      </select>
    </div>
  </header>

  <main class="flex-grow container mx-auto p-4 flex flex-col md:flex-row gap-6">
    <!-- Market Panel -->
    <section class="md:w-2/3 bg-gray-800 rounded-lg p-4 shadow-lg flex flex-col">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-3">
        <h2 id="market-title" class="text-2xl font-semibold border-b border-gray-700 pb-2 flex items-center gap-2">
          <span>Market</span>
          <button id="toggle-chart-btn" class="text-sm bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded flex items-center gap-2">
            <i class="fas fa-chart-line"></i> <span id="toggle-chart-text">Chart</span>
          </button>
        </h2>
        <select id="crypto-select" class="bg-gray-700 text-gray-100 rounded px-3 py-1 font-mono w-full sm:w-48" aria-label="Select Cryptocurrency">
          <!-- Options dynamically filled -->
        </select>
      </div>

      <div id="market-table-wrapper" class="overflow-x-auto scrollbar-thin max-h-[350px] md:max-h-[400px] rounded">
        <table class="w-full text-left table-auto border-collapse" aria-describedby="market-title">
          <thead>
            <tr class="border-b border-gray-700 sticky top-0 bg-gray-800 z-10">
              <th class="py-2 px-3">Cryptocurrency</th>
              <th class="py-2 px-3">Price (USD)</th>
              <th class="py-2 px-3">Change</th>
              <th class="py-2 px-3">Buy</th>
              <th class="py-2 px-3">Sell</th>
            </tr>
          </thead>
          <tbody id="market-table-body" class="divide-y divide-gray-700" role="rowgroup">
            <!-- Dynamically filled -->
          </tbody>
        </table>
      </div>

      <canvas id="priceChart" class="mt-4 rounded-lg bg-gray-900" style="display:none;" aria-label="Price chart" role="img"></canvas>

      <div id="chart-action-section" class="mt-4 bg-gray-700 rounded p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4" style="display:none;">
        <div class="flex flex-col sm:flex-row sm:items-center gap-3 w-full sm:w-auto">
          <button id="chart-buy-btn" class="flex-1 sm:flex-none bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded flex items-center justify-center gap-2" aria-label="Buy cryptocurrency">
            <i class="fas fa-shopping-cart"></i> <span id="buy-text">Buy</span>
          </button>
          <button id="chart-sell-btn" class="flex-1 sm:flex-none bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-6 rounded flex items-center justify-center gap-2" aria-label="Sell cryptocurrency">
            <i class="fas fa-dollar-sign"></i> <span id="sell-text">Sell</span>
          </button>
        </div>
        <div class="text-gray-300 font-mono text-center sm:text-right w-full sm:w-auto" id="chart-current-price" aria-live="polite" aria-atomic="true">
          Price: $0.00
        </div>
      </div>

      <div class="mt-4 text-sm text-gray-400 italic text-center sm:text-left" id="price-update-text">
        Prices update every 5 seconds.
      </div>

      <!-- Auction Section -->
      <section id="auction-section" class="mt-8 bg-gray-700 rounded-lg p-4 flex flex-col gap-4" aria-label="Auction Section">
        <h3 id="auction-title" class="text-xl font-semibold border-b border-gray-600 pb-2">Auction</h3>
        <div id="auction-info" class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
          <div class="flex items-center gap-3">
            <img id="auction-crypto-img" src="" alt="" width="40" height="40" class="rounded-sm border border-gray-600" />
            <div>
              <p id="auction-crypto-name" class="font-semibold text-lg"></p>
              <p id="auction-crypto-symbol" class="text-gray-300 font-mono"></p>
            </div>
          </div>
          <div class="text-gray-300 font-mono text-center sm:text-right">
            <p><span id="auction-current-bid-label">Current Bid</span>: $<span id="auction-current-bid">0.00</span></p>
            <p><span id="auction-timer-label">Time Left</span>: <span id="auction-timer">00:00</span></p>
          </div>
        </div>
        <div class="flex flex-col sm:flex-row sm:items-center gap-3">
          <input
            type="number"
            id="auction-bid-input"
            min="0"
            step="0.01"
            placeholder="Enter your bid"
            class="flex-grow p-2 rounded bg-gray-600 border border-gray-500 text-white font-mono"
            aria-label="Enter your bid amount"
          />
          <button id="auction-bid-btn" class="bg-yellow-600 hover:bg-yellow-700 text-gray-900 font-semibold py-2 px-6 rounded flex items-center justify-center gap-2 whitespace-nowrap" aria-label="Place bid">
            <i class="fas fa-gavel"></i> <span id="auction-bid-text">Place Bid</span>
          </button>
        </div>
        <p id="auction-message" class="text-sm text-yellow-400 min-h-[1.5rem]" aria-live="polite" aria-atomic="true"></p>
        <div id="auction-bids-list" class="mt-2 max-h-40 overflow-y-auto text-sm text-gray-300 font-mono space-y-1" aria-label="Recent bids">
          <!-- Recent bids will appear here -->
        </div>
      </section>
    </section>

    <!-- Player Panel -->
    <section class="md:w-1/3 bg-gray-800 rounded-lg p-6 shadow-lg flex flex-col">
      <h2 id="player-info-title" class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">Player Info</h2>
      <div class="mb-4">
        <p>
          <span class="font-semibold" id="cash-label">Cash:</span>
          $<span id="player-cash">1000.00</span>
        </p>
        <p>
          <span class="font-semibold" id="networth-label">Net Worth:</span>
          $<span id="player-networth">1000.00</span>
        </p>
      </div>
      <h3 id="portfolio-title" class="text-xl font-semibold mb-2 border-b border-gray-700 pb-1">Portfolio</h3>
      <div class="flex-grow overflow-y-auto scrollbar-thin max-h-[400px]">
        <table class="w-full text-left table-auto border-collapse" aria-describedby="portfolio-title">
          <thead>
            <tr class="border-b border-gray-700 sticky top-0 bg-gray-800 z-10">
              <th class="py-2 px-3">Cryptocurrency</th>
              <th class="py-2 px-3">Quantity</th>
              <th class="py-2 px-3">Value (USD)</th>
            </tr>
          </thead>
          <tbody id="inventory-table-body" class="divide-y divide-gray-700" role="rowgroup">
            <!-- Dynamically filled -->
          </tbody>
        </table>
      </div>
      <button
        id="reset-button"
        class="mt-6 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 rounded transition"
        title="Reset game"
      >
        <i class="fas fa-redo-alt mr-2"></i> <span id="reset-text">Reset Game</span>
      </button>
    </section>
  </main>

  <footer class="bg-gray-800 p-4 text-center text-gray-500 text-sm" id="footer-text">
    &copy; 2025 Crypto Trader Game Simulator. Made by SpectraSoft team.
  </footer>

  <script>
    // Translations
    const translations = {
      en: {
        market: "Market",
        chart: "Chart",
        table: "Table",
        buy: "Buy",
        sell: "Sell",
        pricesUpdate: "Prices update every 5 seconds.",
        auction: "Auction",
        currentBid: "Current Bid",
        timeLeft: "Time Left",
        placeBid: "Place Bid",
        enterBid: "Enter your bid",
        noCryptoSelected: "Select Cryptocurrency",
        cash: "Cash:",
        netWorth: "Net Worth:",
        portfolio: "Portfolio",
        resetGame: "Reset Game",
        auctionWon: "You won the auction for 1 {symbol} at ${price}!",
        auctionNoWinner: "Auction ended with no winner.",
        auctionNoCash: "You won the auction but don't have enough cash to pay!",
        auctionBidMin: "Bid must be at least ${min}.",
        auctionBidInvalid: "Please enter a valid bid amount.",
        auctionBidNoCash: "You do not have enough cash for this bid.",
        auctionHighestBidder: "You are the highest bidder!",
        noHoldingsSell: "No holdings to sell",
        noCryptoPortfolio: "No cryptocurrencies in portfolio.",
        selectLanguage: "Language:",
      },
      es: {
        market: "Mercado",
        chart: "Gráfico",
        table: "Tabla",
        buy: "Comprar",
        sell: "Vender",
        pricesUpdate: "Los precios se actualizan cada 5 segundos.",
        auction: "Subasta",
        currentBid: "Oferta Actual",
        timeLeft: "Tiempo Restante",
        placeBid: "Hacer Oferta",
        enterBid: "Ingrese su oferta",
        noCryptoSelected: "Seleccione Criptomoneda",
        cash: "Efectivo:",
        netWorth: "Valor Neto:",
        portfolio: "Portafolio",
        resetGame: "Reiniciar Juego",
        auctionWon: "¡Ganaste la subasta por 1 {symbol} a ${price}!",
        auctionNoWinner: "La subasta terminó sin ganador.",
        auctionNoCash: "¡Ganaste la subasta pero no tienes suficiente efectivo para pagar!",
        auctionBidMin: "La oferta debe ser al menos ${min}.",
        auctionBidInvalid: "Por favor ingrese una oferta válida.",
        auctionBidNoCash: "No tienes suficiente efectivo para esta oferta.",
        auctionHighestBidder: "¡Eres el mejor postor!",
        noHoldingsSell: "No hay activos para vender",
        noCryptoPortfolio: "No hay criptomonedas en el portafolio.",
        selectLanguage: "Idioma:",
      },
      fr: {
        market: "Marché",
        chart: "Graphique",
        table: "Tableau",
        buy: "Acheter",
        sell: "Vendre",
        pricesUpdate: "Les prix sont mis à jour toutes les 5 secondes.",
        auction: "Enchère",
        currentBid: "Offre Actuelle",
        timeLeft: "Temps Restant",
        placeBid: "Faire une Offre",
        enterBid: "Entrez votre offre",
        noCryptoSelected: "Sélectionnez une Cryptomonnaie",
        cash: "Cash :",
        netWorth: "Valeur Nette :",
        portfolio: "Portefeuille",
        resetGame: "Réinitialiser le Jeu",
        auctionWon: "Vous avez gagné l'enchère pour 1 {symbol} à ${price} !",
        auctionNoWinner: "L'enchère s'est terminée sans gagnant.",
        auctionNoCash: "Vous avez gagné l'enchère mais n'avez pas assez de cash pour payer !",
        auctionBidMin: "L'offre doit être au moins de ${min}.",
        auctionBidInvalid: "Veuillez entrer une offre valide.",
        auctionBidNoCash: "Vous n'avez pas assez de cash pour cette offre.",
        auctionHighestBidder: "Vous êtes le meilleur enchérisseur !",
        noHoldingsSell: "Aucun actif à vendre",
        noCryptoPortfolio: "Aucune cryptomonnaie dans le portefeuille.",
        selectLanguage: "Langue :",
      },
      de: {
        market: "Markt",
        chart: "Diagramm",
        table: "Tabelle",
        buy: "Kaufen",
        sell: "Verkaufen",
        pricesUpdate: "Preise werden alle 5 Sekunden aktualisiert.",
        auction: "Auktion",
        currentBid: "Aktuelles Gebot",
        timeLeft: "Verbleibende Zeit",
        placeBid: "Gebot abgeben",
        enterBid: "Geben Sie Ihr Gebot ein",
        noCryptoSelected: "Kryptowährung auswählen",
        cash: "Bargeld:",
        netWorth: "Nettovermögen:",
        portfolio: "Portfolio",
        resetGame: "Spiel zurücksetzen",
        auctionWon: "Sie haben die Auktion für 1 {symbol} zu ${price} gewonnen!",
        auctionNoWinner: "Die Auktion endete ohne Gewinner.",
        auctionNoCash: "Sie haben die Auktion gewonnen, aber nicht genug Bargeld zum Bezahlen!",
        auctionBidMin: "Das Gebot muss mindestens ${min} betragen.",
        auctionBidInvalid: "Bitte geben Sie ein gültiges Gebot ein.",
        auctionBidNoCash: "Sie haben nicht genug Bargeld für dieses Gebot.",
        auctionHighestBidder: "Sie sind der Höchstbietende!",
        noHoldingsSell: "Keine Bestände zum Verkaufen",
        noCryptoPortfolio: "Keine Kryptowährungen im Portfolio.",
        selectLanguage: "Sprache:",
      },
      zh: {
        market: "市场",
        chart: "图表",
        table: "表格",
        buy: "买入",
        sell: "卖出",
        pricesUpdate: "价格每5秒更新一次。",
        auction: "拍卖",
        currentBid: "当前出价",
        timeLeft: "剩余时间",
        placeBid: "出价",
        enterBid: "输入您的出价",
        noCryptoSelected: "选择加密货币",
        cash: "现金：",
        netWorth: "净资产：",
        portfolio: "投资组合",
        resetGame: "重置游戏",
        auctionWon: "您以${price}赢得了1个{symbol}的拍卖！",
        auctionNoWinner: "拍卖结束无人获胜。",
        auctionNoCash: "您赢得了拍卖，但没有足够的现金支付！",
        auctionBidMin: "出价必须至少为${min}。",
        auctionBidInvalid: "请输入有效的出价金额。",
        auctionBidNoCash: "您的现金不足以支付此出价。",
        auctionHighestBidder: "您是最高出价者！",
        noHoldingsSell: "无持仓可卖",
        noCryptoPortfolio: "投资组合中无加密货币。",
        selectLanguage: "语言：",
      }
    };

    // Current language
    let currentLang = 'en';

    // Fake bot users for auction
    const botUsers = [
      { name: "CryptoBot42", avatar: "https://i.pravatar.cc/40?img=12" },
      { name: "SatoshiFan", avatar: "https://i.pravatar.cc/40?img=5" },
      { name: "BlockChainer", avatar: "https://i.pravatar.cc/40?img=8" },
      { name: "AltcoinKing", avatar: "https://i.pravatar.cc/40?img=15" },
      { name: "DeFiDiva", avatar: "https://i.pravatar.cc/40?img=20" },
      { name: "HODLMaster", avatar: "https://i.pravatar.cc/40?img=25" },
      { name: "TokenTrader", avatar: "https://i.pravatar.cc/40?img=30" },
      { name: "WhaleWatcher", avatar: "https://i.pravatar.cc/40?img=35" }
    ];

    // Cryptocurrencies data (expanded list with real-ish images)
    const cryptocurrencies = [
      { id: "bitcoin", name: "Bitcoin", symbol: "BTC", basePrice: 30000, volatility: 0.06, img: "https://cryptologos.cc/logos/bitcoin-btc-logo.png?v=025", alt: "Bitcoin logo" },
      { id: "ethereum", name: "Ethereum", symbol: "ETH", basePrice: 2000, volatility: 0.07, img: "https://cryptologos.cc/logos/ethereum-eth-logo.png?v=025", alt: "Ethereum logo" },
      { id: "binancecoin", name: "Binance Coin", symbol: "BNB", basePrice: 300, volatility: 0.08, img: "https://cryptologos.cc/logos/binance-coin-bnb-logo.png?v=025", alt: "Binance Coin logo" },
      { id: "cardano", name: "Cardano", symbol: "ADA", basePrice: 1.2, volatility: 0.09, img: "https://cryptologos.cc/logos/cardano-ada-logo.png?v=025", alt: "Cardano logo" },
      { id: "solana", name: "Solana", symbol: "SOL", basePrice: 25, volatility: 0.1, img: "https://cryptologos.cc/logos/solana-sol-logo.png?v=025", alt: "Solana logo" },
      { id: "ripple", name: "Ripple", symbol: "XRP", basePrice: 0.6, volatility: 0.1, img: "https://cryptologos.cc/logos/xrp-xrp-logo.png?v=025", alt: "Ripple logo" },
      { id: "dogecoin", name: "Dogecoin", symbol: "DOGE", basePrice: 0.07, volatility: 0.12, img: "https://cryptologos.cc/logos/dogecoin-doge-logo.png?v=025", alt: "Dogecoin logo" },
      { id: "polkadot", name: "Polkadot", symbol: "DOT", basePrice: 6, volatility: 0.11, img: "https://cryptologos.cc/logos/polkadot-new-dot-logo.png?v=025", alt: "Polkadot logo" },
      { id: "litecoin", name: "Litecoin", symbol: "LTC", basePrice: 90, volatility: 0.09, img: "https://cryptologos.cc/logos/litecoin-ltc-logo.png?v=025", alt: "Litecoin logo" },
      { id: "chainlink", name: "Chainlink", symbol: "LINK", basePrice: 7, volatility: 0.1, img: "https://cryptologos.cc/logos/chainlink-link-logo.png?v=025", alt: "Chainlink logo" },
      { id: "uniswap", name: "Uniswap", symbol: "UNI", basePrice: 6, volatility: 0.1, img: "https://cryptologos.cc/logos/uniswap-uni-logo.png?v=025", alt: "Uniswap logo" },
      { id: "stellar", name: "Stellar", symbol: "XLM", basePrice: 0.3, volatility: 0.1, img: "https://cryptologos.cc/logos/stellar-xlm-logo.png?v=025", alt: "Stellar logo" },
      { id: "vechain", name: "VeChain", symbol: "VET", basePrice: 0.1, volatility: 0.12, img: "https://cryptologos.cc/logos/vechain-vet-logo.png?v=025", alt: "VeChain logo" },
      { id: "theta", name: "Theta", symbol: "THETA", basePrice: 1.5, volatility: 0.1, img: "https://cryptologos.cc/logos/theta-theta-logo.png?v=025", alt: "Theta logo" },
      { id: "filecoin", name: "Filecoin", symbol: "FIL", basePrice: 5, volatility: 0.11, img: "https://cryptologos.cc/logos/filecoin-fil-logo.png?v=025", alt: "Filecoin logo" },
      { id: "avalanche", name: "Avalanche", symbol: "AVAX", basePrice: 15, volatility: 0.1, img: "https://cryptologos.cc/logos/avalanche-avax-logo.png?v=025", alt: "Avalanche logo" }
    ];

    // Game state
    let player = {
      cash: 1000,
      portfolio: {},
    };

    // Current market prices and price history for chart
    let marketPrices = {};
    let priceHistory = {}; // { cryptoId: [price1, price2, ...] }

    // Auction state
    let auction = {
      active: false,
      cryptoId: null,
      currentBid: 0,
      highestBidder: null,
      endTime: null,
      timerInterval: null,
      minIncrement: 0.01,
      bidHistory: [], // {user, amount, time}
    };

    // Initialize portfolio quantities to zero
    cryptocurrencies.forEach(c => {
      player.portfolio[c.id] = 0;
      priceHistory[c.id] = [];
    });

    // Utility: format number as currency
    function formatCurrency(num) {
      return num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    // Translate helper
    function t(key, vars = {}) {
      let str = translations[currentLang][key] || key;
      Object.entries(vars).forEach(([k,v]) => {
        str = str.replace(`{${k}}`, v);
      });
      return str;
    }

    // Generate new prices based on volatility and previous price
    function generateNewPrice(oldPrice, basePrice, volatility) {
      const changePercent = (Math.random() * 2 - 1) * volatility;
      let newPrice = oldPrice * (1 + changePercent);
      newPrice = Math.max(newPrice, basePrice * 0.1);
      newPrice = Math.min(newPrice, basePrice * 5);
      return newPrice;
    }

    // Initialize market prices with base prices and fill price history with initial values
    function initMarketPrices() {
      cryptocurrencies.forEach(c => {
        marketPrices[c.id] = {
          price: c.basePrice,
          oldPrice: c.basePrice,
        };
        priceHistory[c.id] = Array(20).fill(c.basePrice);
      });
    }

    // Update market prices every 5 seconds
    function updateMarketPrices() {
      cryptocurrencies.forEach(c => {
        const oldPrice = marketPrices[c.id].price;
        const newPrice = generateNewPrice(oldPrice, c.basePrice, c.volatility);
        marketPrices[c.id].oldPrice = oldPrice;
        marketPrices[c.id].price = newPrice;

        priceHistory[c.id].push(newPrice);
        if (priceHistory[c.id].length > 20) priceHistory[c.id].shift();
      });
      renderMarket();
      renderPortfolio();
      updateNetWorth();
      if (currentChartCrypto) updateChart(currentChartCrypto);
      updateChartCurrentPrice();
    }

    // Render market table
    function renderMarket() {
      const tbody = document.getElementById("market-table-body");
      tbody.innerHTML = "";
      cryptocurrencies.forEach(c => {
        const priceObj = marketPrices[c.id];
        const price = priceObj.price;
        const oldPrice = priceObj.oldPrice;
        const change = price - oldPrice;
        const changePercent = (change / oldPrice) * 100;

        const tr = document.createElement("tr");
        tr.className = "hover:bg-gray-700 cursor-pointer";
        tr.title = `${t('clickViewChart', {name: c.name}) || `Click to view ${c.name} price chart`}`;
        tr.addEventListener("click", () => {
          selectCryptoInDropdown(c.id);
          openChart(c.id);
        });

        const tdCrypto = document.createElement("td");
        tdCrypto.className = "py-2 px-3 flex items-center gap-2";
        const img = document.createElement("img");
        img.src = c.img;
        img.alt = c.alt;
        img.width = 32;
        img.height = 32;
        img.className = "rounded-sm border border-gray-600";
        tdCrypto.appendChild(img);
        const spanName = document.createElement("span");
        spanName.textContent = `${c.name} (${c.symbol})`;
        tdCrypto.appendChild(spanName);

        const tdPrice = document.createElement("td");
        tdPrice.className = "py-2 px-3 font-mono";
        tdPrice.textContent = `$${formatCurrency(price)}`;

        const tdChange = document.createElement("td");
        tdChange.className = "py-2 px-3 font-mono flex items-center gap-1";
        const arrow = document.createElement("i");
        if (change > 0) {
          tdChange.classList.add("text-green-400");
          arrow.className = "fas fa-arrow-up";
        } else if (change < 0) {
          tdChange.classList.add("text-red-400");
          arrow.className = "fas fa-arrow-down";
        } else {
          tdChange.classList.add("text-gray-400");
          arrow.className = "fas fa-minus";
        }
        tdChange.appendChild(arrow);
        const spanChange = document.createElement("span");
        spanChange.textContent = `${change >= 0 ? "+" : ""}${formatCurrency(change)} (${changePercent >= 0 ? "+" : ""}${changePercent.toFixed(2)}%)`;
        tdChange.appendChild(spanChange);

        const tdBuy = document.createElement("td");
        tdBuy.className = "py-2 px-3";
        const buyBtn = document.createElement("button");
        buyBtn.className = "bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded font-semibold w-full";
        buyBtn.textContent = t('buy');
        buyBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          openTradeModal(c.id, "buy");
        });
        tdBuy.appendChild(buyBtn);

        const tdSell = document.createElement("td");
        tdSell.className = "py-2 px-3";
        const sellBtn = document.createElement("button");
        sellBtn.className = "bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded font-semibold w-full";
        sellBtn.textContent = t('sell');
        sellBtn.disabled = player.portfolio[c.id] === 0;
        sellBtn.title = player.portfolio[c.id] === 0 ? t('noHoldingsSell') : "";
        sellBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          openTradeModal(c.id, "sell");
        });
        tdSell.appendChild(sellBtn);

        tr.appendChild(tdCrypto);
        tr.appendChild(tdPrice);
        tr.appendChild(tdChange);
        tr.appendChild(tdBuy);
        tr.appendChild(tdSell);

        tbody.appendChild(tr);
      });
    }

    // Render portfolio table
    function renderPortfolio() {
      const tbody = document.getElementById("inventory-table-body");
      tbody.innerHTML = "";
      cryptocurrencies.forEach(c => {
        const qty = player.portfolio[c.id];
        if (qty === 0) return;
        const price = marketPrices[c.id].price;
        const value = qty * price;

        const tr = document.createElement("tr");
        tr.className = "hover:bg-gray-700";

        const tdCrypto = document.createElement("td");
        tdCrypto.className = "py-2 px-3 flex items-center gap-2";
        const img = document.createElement("img");
        img.src = c.img;
        img.alt = c.alt;
        img.width = 32;
        img.height = 32;
        img.className = "rounded-sm border border-gray-600";
        tdCrypto.appendChild(img);
        const spanName = document.createElement("span");
        spanName.textContent = `${c.name} (${c.symbol})`;
        tdCrypto.appendChild(spanName);

        const tdQty = document.createElement("td");
        tdQty.className = "py-2 px-3 font-mono";
        tdQty.textContent = qty.toFixed(6);

        const tdValue = document.createElement("td");
        tdValue.className = "py-2 px-3 font-mono";
        tdValue.textContent = `$${formatCurrency(value)}`;

        tr.appendChild(tdCrypto);
        tr.appendChild(tdQty);
        tr.appendChild(tdValue);

        tbody.appendChild(tr);
      });

      if (tbody.children.length === 0) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 3;
        td.className = "py-4 px-3 text-center text-gray-500 italic";
        td.textContent = t('noCryptoPortfolio');
        tr.appendChild(td);
        tbody.appendChild(tr);
      }
    }

    // Update player cash display
    function updateCash() {
      const cashSpan = document.getElementById("player-cash");
      cashSpan.textContent = formatCurrency(player.cash);
    }

    // Update net worth display
    function updateNetWorth() {
      let netWorth = player.cash;
      cryptocurrencies.forEach(c => {
        const qty = player.portfolio[c.id];
        const price = marketPrices[c.id].price;
        netWorth += qty * price;
      });
      const netWorthSpan = document.getElementById("player-networth");
      netWorthSpan.textContent = formatCurrency(netWorth);
    }

    // Trade modal elements
    let modal, modalOverlay, modalTitle, modalCryptoName, modalPrice, modalInput, modalTotal, modalConfirmBtn, modalCancelBtn;
    let currentTrade = { cryptoId: null, type: null };

    function createTradeModal() {
      modalOverlay = document.createElement("div");
      modalOverlay.className = "fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden";

      modal = document.createElement("div");
      modal.className = "bg-gray-800 rounded-lg p-6 w-11/12 max-w-md shadow-lg flex flex-col";

      modalTitle = document.createElement("h3");
      modalTitle.className = "text-2xl font-semibold mb-4 text-center";

      modalCryptoName = document.createElement("p");
      modalCryptoName.className = "text-lg mb-2 text-center";

      modalPrice = document.createElement("p");
      modalPrice.className = "text-gray-400 mb-4 text-center font-mono";

      const inputLabel = document.createElement("label");
      inputLabel.className = "block mb-1 font-semibold";
      inputLabel.textContent = "Quantity:";

      modalInput = document.createElement("input");
      modalInput.type = "number";
      modalInput.min = "0.000001";
      modalInput.step = "0.000001";
      modalInput.value = "0.000001";
      modalInput.className = "w-full p-2 rounded bg-gray-700 border border-gray-600 text-white font-mono";

      modalTotal = document.createElement("p");
      modalTotal.className = "mt-3 text-center font-mono";

      const buttonsDiv = document.createElement("div");
      buttonsDiv.className = "mt-6 flex justify-center gap-4";

      modalConfirmBtn = document.createElement("button");
      modalConfirmBtn.className = "bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded disabled:opacity-50 disabled:cursor-not-allowed";
      modalConfirmBtn.textContent = "Confirm";

      modalCancelBtn = document.createElement("button");
      modalCancelBtn.className = "bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-6 rounded";
      modalCancelBtn.textContent = "Cancel";

      buttonsDiv.appendChild(modalConfirmBtn);
      buttonsDiv.appendChild(modalCancelBtn);

      modal.appendChild(modalTitle);
      modal.appendChild(modalCryptoName);
      modal.appendChild(modalPrice);
      modal.appendChild(inputLabel);
      modal.appendChild(modalInput);
      modal.appendChild(modalTotal);
      modal.appendChild(buttonsDiv);

      modalOverlay.appendChild(modal);
      document.body.appendChild(modalOverlay);

      modalInput.addEventListener("input", updateModalTotal);
      modalCancelBtn.addEventListener("click", closeTradeModal);
      modalConfirmBtn.addEventListener("click", confirmTrade);
      modalOverlay.addEventListener("click", (e) => {
        if (e.target === modalOverlay) closeTradeModal();
      });
    }

    function openTradeModal(cryptoId, type) {
      currentTrade.cryptoId = cryptoId;
      currentTrade.type = type;

      const crypto = cryptocurrencies.find(c => c.id === cryptoId);
      const price = marketPrices[cryptoId].price;

      modalTitle.textContent = type === "buy" ? t('buy') + " Cryptocurrency" : t('sell') + " Cryptocurrency";
      modalCryptoName.textContent = `${crypto.name} (${crypto.symbol})`;
      modalPrice.textContent = `Price per unit: $${formatCurrency(price)}`;
      modalInput.value = "0.000001";
      modalInput.min = "0.000001";
      modalInput.step = "0.000001";

      if (type === "buy") {
        const maxQty = player.cash / price;
        modalInput.max = maxQty > 0 ? maxQty : 0;
        modalConfirmBtn.disabled = maxQty < 0.000001;
        if (modalConfirmBtn.disabled) modalInput.value = "0";
      } else {
        const maxQty = player.portfolio[cryptoId];
        modalInput.max = maxQty;
        modalConfirmBtn.disabled = maxQty < 0.000001;
        if (modalConfirmBtn.disabled) modalInput.value = "0";
      }

      updateModalTotal();

      modalOverlay.classList.remove("hidden");
      modalInput.focus();
      modalInput.select();
    }

    function closeTradeModal() {
      modalOverlay.classList.add("hidden");
      currentTrade = { cryptoId: null, type: null };
    }

    function updateModalTotal() {
      const cryptoId = currentTrade.cryptoId;
      const type = currentTrade.type;
      if (!cryptoId || !type) return;

      const price = marketPrices[cryptoId].price;
      let qty = parseFloat(modalInput.value);
      if (isNaN(qty) || qty < 0) qty = 0;

      const minQty = parseFloat(modalInput.min);
      const maxQty = parseFloat(modalInput.max);
      if (qty < minQty) qty = minQty;
      if (qty > maxQty) qty = maxQty;
      modalInput.value = qty.toFixed(6);

      const total = qty * price;
      modalTotal.textContent = `Total: $${formatCurrency(total)}`;

      if (qty < minQty) {
        modalConfirmBtn.disabled = true;
      } else if (type === "buy" && total > player.cash) {
        modalConfirmBtn.disabled = true;
      } else if (type === "sell" && qty > player.portfolio[cryptoId]) {
        modalConfirmBtn.disabled = true;
      } else {
        modalConfirmBtn.disabled = false;
      }
    }

    function confirmTrade() {
      const cryptoId = currentTrade.cryptoId;
      const type = currentTrade.type;
      if (!cryptoId || !type) return;

      const price = marketPrices[cryptoId].price;
      const qty = parseFloat(modalInput.value);
      if (isNaN(qty) || qty <= 0) return;

      if (type === "buy") {
        const totalCost = qty * price;
        if (totalCost > player.cash) {
          alert(t('auctionBidNoCash'));
          return;
        }
        player.cash -= totalCost;
        player.portfolio[cryptoId] += qty;
      } else if (type === "sell") {
        if (qty > player.portfolio[cryptoId]) {
          alert(t('noHoldingsSell'));
          return;
        }
        const totalGain = qty * price;
        player.cash += totalGain;
        player.portfolio[cryptoId] -= qty;
      }

      updateCash();
      renderPortfolio();
      updateNetWorth();
      renderMarket();
      closeTradeModal();
    }

    function resetGame() {
      if (!confirm("Are you sure you want to reset the game? Your progress will be lost.")) return;
      player.cash = 1000;
      cryptocurrencies.forEach(c => {
        player.portfolio[c.id] = 0;
        priceHistory[c.id] = Array(20).fill(c.basePrice);
        marketPrices[c.id].price = c.basePrice;
        marketPrices[c.id].oldPrice = c.basePrice;
      });
      updateCash();
      renderPortfolio();
      updateNetWorth();
      renderMarket();
      if (currentChartCrypto) updateChart(currentChartCrypto);
      updateChartCurrentPrice();
      resetAuction();
    }

    // Chart.js setup
    let priceChart = null;
    let currentChartCrypto = null;

    const ctx = document.getElementById("priceChart").getContext("2d");

    function createChart() {
      priceChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array(20).fill(''),
          datasets: [{
            label: '',
            data: [],
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.3)',
            fill: true,
            tension: 0.3,
            pointRadius: 2,
            pointHoverRadius: 5,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: false,
          scales: {
            x: { display: false },
            y: {
              beginAtZero: false,
              ticks: {
                color: '#9ca3af',
                font: { family: "'Roboto Mono', monospace" }
              },
              grid: { color: '#374151' }
            }
          },
          plugins: {
            legend: {
              labels: {
                color: '#d1d5db',
                font: { family: "'Roboto Mono', monospace" }
              }
            },
            tooltip: {
              mode: 'index',
              intersect: false,
              backgroundColor: '#111827',
              titleFont: { family: "'Roboto Mono', monospace" },
              bodyFont: { family: "'Roboto Mono', monospace" },
              callbacks: {
                label: ctx => `$${formatCurrency(ctx.parsed.y)}`
              }
            }
          },
          interaction: {
            mode: 'nearest',
            intersect: false
          }
        }
      });
    }

    function updateChart(cryptoId) {
      if (!priceChart) return;
      const crypto = cryptocurrencies.find(c => c.id === cryptoId);
      const prices = priceHistory[cryptoId];
      priceChart.data.datasets[0].label = `${crypto.name} (${crypto.symbol}) Price (USD)`;
      priceChart.data.datasets[0].data = prices;
      priceChart.update();
      updateChartCurrentPrice();
    }

    function updateChartCurrentPrice() {
      if (!currentChartCrypto) return;
      const price = marketPrices[currentChartCrypto].price;
      const el = document.getElementById("chart-current-price");
      el.textContent = `${t('price') || 'Price'}: $${formatCurrency(price)}`;
    }

    function openChart(cryptoId) {
      currentChartCrypto = cryptoId;
      document.getElementById("priceChart").style.display = "block";
      document.getElementById("market-table-wrapper").style.display = "none";
      document.getElementById("chart-action-section").style.display = "flex";
      updateChart(cryptoId);
      document.getElementById("toggle-chart-text").textContent = t('table');
      const icon = document.createElement("i");
      icon.className = "fas fa-table mr-2";
      const btn = document.getElementById("toggle-chart-btn");
      btn.innerHTML = "";
      btn.appendChild(icon);
      btn.appendChild(document.createTextNode(t('table')));
      selectCryptoInDropdown(cryptoId);
      updateAuctionForCrypto(cryptoId);
    }

    function closeChart() {
      currentChartCrypto = null;
      document.getElementById("priceChart").style.display = "none";
      document.getElementById("market-table-wrapper").style.display = "block";
      document.getElementById("chart-action-section").style.display = "none";
      document.getElementById("toggle-chart-text").textContent = t('chart');
      const icon = document.createElement("i");
      icon.className = "fas fa-chart-line mr-2";
      const btn = document.getElementById("toggle-chart-btn");
      btn.innerHTML = "";
      btn.appendChild(icon);
      btn.appendChild(document.createTextNode(t('chart')));
      document.getElementById("crypto-select").value = "";
      clearAuctionDisplay();
    }

    function toggleChart() {
      if (currentChartCrypto) {
        closeChart();
      } else {
        openChart(cryptocurrencies[0].id);
      }
    }

    function fillCryptoSelect() {
      const select = document.getElementById("crypto-select");
      select.innerHTML = `<option value="" disabled selected>${t('noCryptoSelected')}</option>`;
      cryptocurrencies.forEach(c => {
        const option = document.createElement("option");
        option.value = c.id;
        option.textContent = `${c.name} (${c.symbol})`;
        select.appendChild(option);
      });
    }

    function selectCryptoInDropdown(cryptoId) {
      const select = document.getElementById("crypto-select");
      select.value = cryptoId;
    }

    function onCryptoSelectChange() {
      const select = document.getElementById("crypto-select");
      const val = select.value;
      if (!val) return;
      openChart(val);
    }

    function onChartBuyClick() {
      if (!currentChartCrypto) return;
      openTradeModal(currentChartCrypto, "buy");
    }
    function onChartSellClick() {
      if (!currentChartCrypto) return;
      openTradeModal(currentChartCrypto, "sell");
    }

    // Auction functions with bots

    function startAuctionCycle() {
      if (auction.timerInterval) clearInterval(auction.timerInterval);
      startNewAuction();
      auction.timerInterval = setInterval(() => {
        startNewAuction();
      }, 120000);
    }

    function startNewAuction() {
      let newCrypto;
      do {
        newCrypto = cryptocurrencies[Math.floor(Math.random() * cryptocurrencies.length)];
      } while (auction.active && newCrypto.id === auction.cryptoId);

      auction.cryptoId = newCrypto.id;
      auction.currentBid = marketPrices[newCrypto.id].price * 0.8;
      auction.highestBidder = null;
      auction.endTime = Date.now() + 60000;
      auction.active = true;
      auction.bidHistory = [];

      updateAuctionDisplay();
      startAuctionTimer();
      simulateBotBids();
    }

    function updateAuctionDisplay() {
      const crypto = cryptocurrencies.find(c => c.id === auction.cryptoId);
      if (!crypto) return;

      document.getElementById("auction-crypto-img").src = crypto.img;
      document.getElementById("auction-crypto-img").alt = crypto.alt;
      document.getElementById("auction-crypto-name").textContent = crypto.name;
      document.getElementById("auction-crypto-symbol").textContent = crypto.symbol;
      document.getElementById("auction-current-bid").textContent = formatCurrency(auction.currentBid);
      document.getElementById("auction-message").textContent = "";
      document.getElementById("auction-bid-input").value = "";
      document.getElementById("auction-bid-input").min = (auction.currentBid + auction.minIncrement).toFixed(2);
      document.getElementById("auction-bid-input").placeholder = `${t('enterBid') || 'Enter your bid'} (≥ $${(auction.currentBid + auction.minIncrement).toFixed(2)})`;
      document.getElementById("auction-bid-btn").disabled = false;
      renderAuctionBids();
    }

    function clearAuctionDisplay() {
      document.getElementById("auction-crypto-img").src = "";
      document.getElementById("auction-crypto-img").alt = "";
      document.getElementById("auction-crypto-name").textContent = "";
      document.getElementById("auction-crypto-symbol").textContent = "";
      document.getElementById("auction-current-bid").textContent = "0.00";
      document.getElementById("auction-timer").textContent = "00:00";
      document.getElementById("auction-message").textContent = "";
      document.getElementById("auction-bid-input").value = "";
      document.getElementById("auction-bid-input").placeholder = t('noCryptoSelected');
      document.getElementById("auction-bid-btn").disabled = true;
      document.getElementById("auction-bids-list").innerHTML = "";
    }

    function startAuctionTimer() {
      if (auction.timerCountdown) clearInterval(auction.timerCountdown);
      updateAuctionTimer();
      auction.timerCountdown = setInterval(() => {
        updateAuctionTimer();
      }, 1000);
    }

    function updateAuctionTimer() {
      const now = Date.now();
      const diff = auction.endTime - now;
      if (diff <= 0) {
        endAuction();
        return;
      }
      const seconds = Math.floor(diff / 1000);
      const minutes = Math.floor(seconds / 60);
      const secs = seconds % 60;
      document.getElementById("auction-timer").textContent = `${minutes.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
    }

    function endAuction() {
      clearInterval(auction.timerCountdown);
      auction.active = false;
      document.getElementById("auction-timer").textContent = "00:00";

      if (auction.highestBidder === "player") {
        if (player.cash >= auction.currentBid) {
          player.cash -= auction.currentBid;
          player.portfolio[auction.cryptoId] += 1;
          updateCash();
          renderPortfolio();
          updateNetWorth();
          document.getElementById("auction-message").textContent = t('auctionWon', {symbol: cryptocurrencies.find(c => c.id === auction.cryptoId).symbol, price: formatCurrency(auction.currentBid)});
        } else {
          document.getElementById("auction-message").textContent = t('auctionNoCash');
        }
      } else if (auction.highestBidder && auction.highestBidder !== "player") {
        document.getElementById("auction-message").textContent = `${auction.highestBidder} won the auction.`;
      } else {
        document.getElementById("auction-message").textContent = t('auctionNoWinner');
      }

      document.getElementById("auction-bid-btn").disabled = true;

      setTimeout(() => {
        startNewAuction();
      }, 10000);
    }

    function placeAuctionBid() {
      if (!auction.active) return;
      const bidInput = document.getElementById("auction-bid-input");
      let bidValue = parseFloat(bidInput.value);
      if (isNaN(bidValue)) {
        document.getElementById("auction-message").textContent = t('auctionBidInvalid');
        return;
      }
      bidValue = Math.round(bidValue * 100) / 100;
      const minBid = auction.currentBid + auction.minIncrement;
      if (bidValue < minBid) {
        document.getElementById("auction-message").textContent = t('auctionBidMin', {min: minBid.toFixed(2)});
        return;
      }
      if (bidValue > player.cash) {
        document.getElementById("auction-message").textContent = t('auctionBidNoCash');
        return;
      }
      auction.currentBid = bidValue;
      auction.highestBidder = "player";
      auction.bidHistory.unshift({user: "You", amount: bidValue, time: new Date()});
      if (auction.bidHistory.length > 10) auction.bidHistory.pop();
      document.getElementById("auction-current-bid").textContent = formatCurrency(auction.currentBid);
      document.getElementById("auction-message").textContent = t('auctionHighestBidder');
      bidInput.value = "";
      bidInput.min = (auction.currentBid + auction.minIncrement).toFixed(2);
      bidInput.placeholder = `${t('enterBid')} (≥ $${(auction.currentBid + auction.minIncrement).toFixed(2)})`;
      renderAuctionBids();
    }

    // Simulate bot bids randomly during auction
    function simulateBotBids() {
      if (!auction.active) return;
      const botBidCount = Math.floor(Math.random() * 3) + 1; // 1 to 3 bot bids
      let delay = 5000; // start after 5 seconds
      for (let i = 0; i < botBidCount; i++) {
        setTimeout(() => {
          if (!auction.active) return;
          // Only bot bids if player is not highest bidder or random chance
          if (auction.highestBidder !== "player" || Math.random() < 0.7) {
            const bot = botUsers[Math.floor(Math.random() * botUsers.length)];
            const increment = (Math.random() * 5 + 0.5) * auction.minIncrement;
            let newBid = auction.currentBid + increment;
            newBid = Math.round(newBid * 100) / 100;
            if (newBid > player.cash) return; // bot won't bid above player's cash to keep game fair
            auction.currentBid = newBid;
            auction.highestBidder = bot.name;
            auction.bidHistory.unshift({user: bot.name, amount: newBid, time: new Date(), avatar: bot.avatar});
            if (auction.bidHistory.length > 10) auction.bidHistory.pop();
            document.getElementById("auction-current-bid").textContent = formatCurrency(auction.currentBid);
            document.getElementById("auction-message").textContent = "";
            document.getElementById("auction-bid-input").min = (auction.currentBid + auction.minIncrement).toFixed(2);
            document.getElementById("auction-bid-input").placeholder = `${t('enterBid')} (≥ $${(auction.currentBid + auction.minIncrement).toFixed(2)})`;
            renderAuctionBids();
          }
        }, delay);
        delay += Math.floor(Math.random() * 8000) + 3000; // 3-11 seconds between bids
      }
    }

    // Render recent bids list
    function renderAuctionBids() {
      const container = document.getElementById("auction-bids-list");
      container.innerHTML = "";
      auction.bidHistory.forEach(bid => {
        const div = document.createElement("div");
        div.className = "flex items-center gap-2";

        if (bid.avatar) {
          const img = document.createElement("img");
          img.src = bid.avatar;
          img.alt = bid.user;
          img.width = 24;
          img.height = 24;
          img.className = "rounded-full border border-gray-600";
          div.appendChild(img);
        } else {
          const spanIcon = document.createElement("span");
          spanIcon.className = "fas fa-user-circle text-gray-400 text-lg";
          div.appendChild(spanIcon);
        }

        const userSpan = document.createElement("span");
        userSpan.textContent = bid.user;
        userSpan.className = "flex-1 truncate";
        div.appendChild(userSpan);

        const amountSpan = document.createElement("span");
        amountSpan.textContent = `$${formatCurrency(bid.amount)}`;
        amountSpan.className = "font-semibold";
        div.appendChild(amountSpan);

        const timeSpan = document.createElement("span");
        timeSpan.textContent = bid.time.toLocaleTimeString();
        timeSpan.className = "text-xs text-gray-400";
        div.appendChild(timeSpan);

        container.appendChild(div);
      });
    }

    function updateAuctionForCrypto(cryptoId) {
      if (auction.active && auction.cryptoId === cryptoId) {
        updateAuctionDisplay();
      } else {
        clearAuctionDisplay();
      }
    }

    // Language change handler
    function onLanguageChange() {
      const select = document.getElementById("language-select");
      currentLang = select.value;
      applyTranslations();
    }

    // Apply translations to UI
    function applyTranslations() {
      document.getElementById("market-title").querySelector("span").textContent = t('market');
      document.getElementById("toggle-chart-text").textContent = currentChartCrypto ? t('table') : t('chart');
      document.getElementById("buy-text").textContent = t('buy');
      document.getElementById("sell-text").textContent = t('sell');
      document.getElementById("price-update-text").textContent = t('pricesUpdate');
      document.getElementById("auction-title").textContent = t('auction');
      document.getElementById("auction-current-bid-label").textContent = t('currentBid');
      document.getElementById("auction-timer-label").textContent = t('timeLeft');
      document.getElementById("auction-bid-text").textContent = t('placeBid');
      document.getElementById("auction-bid-input").placeholder = t('enterBid');
      document.getElementById("cash-label").textContent = t('cash');
      document.getElementById("networth-label").textContent = t('netWorth');
      document.getElementById("portfolio-title").textContent = t('portfolio');
      document.getElementById("reset-text").textContent = t('resetGame');
      // Update market and portfolio tables
      renderMarket();
      renderPortfolio();
      updateChartCurrentPrice();
      updateAuctionDisplay();
    }

    // Initialize app
    function init() {
      initMarketPrices();
      updateCash();
      renderPortfolio();
      updateNetWorth();
      renderMarket();
      createTradeModal();
      createChart();
      fillCryptoSelect();

      setInterval(updateMarketPrices, 5000);

      document.getElementById("reset-button").addEventListener("click", resetGame);
      document.getElementById("toggle-chart-btn").addEventListener("click", toggleChart);
      document.getElementById("crypto-select").addEventListener("change", onCryptoSelectChange);
      document.getElementById("chart-buy-btn").addEventListener("click", onChartBuyClick);
      document.getElementById("chart-sell-btn").addEventListener("click", onChartSellClick);
      document.getElementById("auction-bid-btn").addEventListener("click", placeAuctionBid);
      document.getElementById("language-select").addEventListener("change", onLanguageChange);

      const icon = document.createElement("i");
      icon.className = "fas fa-chart-line mr-2";
      const btn = document.getElementById("toggle-chart-btn");
      btn.innerHTML = "";
      btn.appendChild(icon);
      btn.appendChild(document.createTextNode(t('chart')));

      startAuctionCycle();
      applyTranslations();
    }

    window.onload = init;
  </script>
</body>
</html>
